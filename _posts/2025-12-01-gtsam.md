---
title: "VIO by gtsam"
date: 2024-12-01 11:00:00 -0000
categories: technical
---

一直都说做一点记录，但是都没有进行执行。先从这个开始开一个坑。

背景：
  在做开源tinynav的时候，一开始的期望是经可能简单易用易开发拓展，于是采用了stereo depth + PnP的方式来得到设备的odometry。但是在实践中，发现这样的方式不够稳定，有时候前后帧的基线太小 + depth的估计不够准确，导致odometry快速地偏离重力方向(相机垂直方向与重力方向不一致)。Realsense上有IMU，但是在GO2上，步伐的震动太大，导致无法在GO2移动过程中直接稳定估计重力。于是转向stereo VO + IMU.



第一步：先实现一个stereo VO.

gtsam 里面有许多关于视觉features相关的factor.
对于双目系统来说，我尝试了
- SmartProjectionPoseFactor
- GenericStereoFactor3D

我一开始直接就是使用SmartProjectionPoseFactor来建模stereo depth 和 temporal feature matching,但是GTSAM会很容易出现underdetermined linear system,导致优化失败。能观察到的一个现象是landmark逐渐优化到相机的背面.后续使用GenericStereoFactor3D也还是会有这样的情况,还不熟悉GTSAM的内部实现，但是基于这个观察，给landmark添加一个由深度信息生成的position 的prior factor来规避掉这个问题。


在实现基础的VO之后,则是加入IMU的factor来进行VIO的实现.这里使用的是`CombinedImuFactor`来建模IMU的预积分信息。在实现过程中,需要注意IMU的bias的建模,以及在优化过程中bias的更新.
最主要的设置是IMU的噪声模型的设置,包括加速度计和陀螺仪的噪声,以及bias的随机游走噪声.这些参数需要根据具体的IMU传感器进行调整.
- accel_noise_density = 0.25     # [m/s^2/√Hz]
- gyro_noise_density = 0.00005   # [rad/s/√Hz]
- bias_acc_rw_sigma = 0.001
- bias_gyro_rw_sigma = 0.0001


