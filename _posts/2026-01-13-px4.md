---
layout: post
title: "PX4的折腾"
date: 2026-01-13 00:00:00 -0000
categories: technical
---
硬件:PIXHAWK 2.4.8

FIREWARE: 商家提供的 PX4 1.15.2

- 所有都配置好了,但是断开QGC之后，LED一直都是都是红灯
  由于我的配件没有电源检测模块，在起飞前的CHECK里面，有一个COM_POWER_COUNT,默认值是1.
  所以我一断开USB，就没有任何电源被飞控检测到，于是无法起飞。
  另外，CBRK_SUPPLY_CHK设置为894281，则飞控就不会进行power valid checks.


- 无法起飞
  
  从曲线上分析:
  ![large_P_and_D](/assets/px4/large_P_and_D.png)
  看Roll Angle,注意到看到曲线有高频震荡,这有两种可能:P的值过高，对于误差的反应过于激烈.D过高，放大了噪声.我这里是先把P调小了.
  ![large_D](/assets/px4/large_D.jpg)
  然后再飞一次
  观察到Roll Angle很平稳，没有大的抖动.有一个突然的跳变，因为室外有风导致的外力.
  Roll Angular Rate在这个突变处，它的跳变比setpoint要高的多，推测是D太高，放大了这个误差.预期的Roll Rate Estimated 和 setpoint的振幅要接近.
  ![took_off](/assets/px4/took_off.jpg)
  P和D都调小了之后，就能起飞了。Roll Angle 虽然开始有一些误差，被I来修正，但最后收敛到setpoint.但Angular Rate能看到estimated是有一些延后于setpoint.

  ![parameters](/assets/px4/parameters.jpg)
  最后的参数.


<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']]
    }
  };
</script>

